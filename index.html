
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>GT HOCKEY</title>
		<link rel="stylesheet" href="themes/gthockey.css" />
		<link rel="stylesheet" href="css/custom.css"/>
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile.structure-1.3.2.css" />
		
	</head>


	<body>


		<div id="home" data-role="page" data-theme="a">
			<div data-role="header" data-position="inline">
				<h1>Georgia Tech Hockey</h1>
			</div>
			<div data-role="content" data-theme="a">
				<ul id="team-list" data-role="listview" data-inset="true">
				    <li><a id="schedule-link" href="#schedule">Schedule</a></li>
				    <li><a id="roster-link" href="#roster">Roster</a></li>
				    <li><a id="statistics-link" href="#statistics">Statistics</a></li>
				</ul>
				<ul id="contact-list" data-role="listview" data-inset="true">
					<li><a id="about-link" href="#about">About</a></li>
					<li><a id="contact-link" href="#contact">Contact</a></li>
					<li><a id="disclaimer-link" href="#disclaimer">Disclaimer</a></li>
				</ul>
			</div>
			<div data-role="footer" data-position="fixed" data-theme="a">
				<h2> </h2>
			</div>
		</div>


		<div id="schedule" data-role="page" data-theme="a" data-add-back-btn="true">
			<div data-role="header" data-position="inline">
				<h1>Schedule</h1>
			</div>
			<div data-role="content" data-theme="a" id="schedule-content">
			</div>
			<div data-role="footer" data-position="fixed" data-theme="a">
				<h2> </h2>
			</div>
		</div>

		<div id="roster" data-role="page" data-theme="a" data-add-back-btn="true">
			<div data-role="header" data-position="inline">
				<h1>Roster</h1>
			</div>
			<div data-role="content" data-theme="a">
				<table data-role="content" class="center-table" id="roster-table" data-mode="reflow" class="ui-responsive table-stroke">
				  <thead>
				    <tr>
				      <th data-priority="1">Number</th>
				      <th data-priority="2">Name</th>
				      <th data-priority="3">Position</th>
				      <th></th>
				    </tr>
				  </thead>
				  <tbody>
				  </tbody>
				</table>
			</div>
			<div data-role="footer" data-position="fixed" data-theme="a">
				<h2> </h2>
			</div>
		</div>


		<!-- We'll see how this fleshes out -->
		<div id="statistics" data-role="page" data-theme="a" data-add-back-btn="true">
			<div data-role="header" data-position="inline">
				<h1>Statistics</h1>
			</div>
			<div data-role="content" data-theme="a">
			</div>
			<div data-role="footer" data-position="fixed" data-theme="a">
				<h2> </h2>
			</div>
		</div>


		<div id="about" data-role="page" data-theme="a" data-add-back-btn="true">
			<div data-role="header" data-position="inline">
				<h1>About</h1>
			</div>
			<div data-role="content" data-theme="a" data-inset="true">
				<p>Georgia Tech Ice Hockey is a Student Run organization founded in 1973.</p>
			</div>
			<div data-role="footer" data-position="fixed" data-theme="a">
				<h2> </h2>
			</div>
		</div>

	<!-- Templates -->
	<script type="text/template" id="schedule-template">
	<table data-role="content" class="center-table" id="schedule-table" class="table-stroke">
		<thead>
			<tr>
				<th>Date</th>
				<th>Time</th>
				<th>Opponent</th>
				<th>GT</th>
				<th>Opp</th>
				<th></th>
			</tr>
		</thead>
		<tbody>
		</tbody>
			<% _.each(games, function(game){ %>
				<tr>
					<td><%= game.get('date') %></td>
					<td><%= game.get('time') %></td>
					<td><%= game.get('opponent') %></td>
					<td><%= game.get('gtf') %></td>
					<td><%= game.get('opponentf') %></td>
					<td><a href="#" data-role="button" data-icon="info"></a></td>
				</tr>
			<% }); %> 
		</tbody>
	</table>
	</script>
	<!--  JS INCLUDES  -->

	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-mobile/1.3.2/jquery.mobile.js"></script>
	
	<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone.js"></script>
	<!-- END JS INCLUDES -->


	<script type="text/javascript">
		//AJAX PREFILTER
		$.ajaxPrefilter(function(options, originalOptions, jqXHR){
			options.url = "http://www.gthockey.com/api" + options.url;
		});
		//Collections
		var Games = Backbone.Collection.extend({
			url: '/schedule.php'
		});

		//Views
		var Schedule = Backbone.View.extend({
			el: '#schedule-content',
			render: function(){
				var that = this;
				var games = new Games();
				games.fetch({
					success: function(games){
						//console.log(games.models);
						var template = _.template($('#schedule-template').html(), {games:games.models});
						that.$el.html(template);
						console.log($('#schedule-table a[data-role=button]'))
						// $('#schedule-table a[data-role=button]').trigger('create');
						$('#schedule-table a[data-role=button]').button();
					}
				});
			}
		});




		//Router
		var Router = Backbone.Router.extend({
			routes: {
				'': 'home',
				'schedule': 'schedule'
			}
		});



		//Declarations 
		var router = new Router();
		var scheduleView = new Schedule();



		//Event Handling
		router.on('route:home',function(){
			console.log("Home page has been loaded");
		});

		router.on('route:schedule',function(){
			scheduleView.render();
		})

		Backbone.history.start();




		// $( document ).bind( 'mobileinit', function(){
		// 	$.mobile.loader.prototype.options.text = "loading";
		// 	$.mobile.loader.prototype.options.textVisible = false;
		// 	$.mobile.loader.prototype.options.theme = "a";
		// 	$.mobile.loader.prototype.options.html = "";
		// });

		// $(document).ready(function(){

		// 	$("#schedule-link").click(function(event){
		// 		$.ajax({
		// 			type: "GET",
		// 			url: "http://www.gthockey.com/api/schedule.php",
		// 			dataType: "jsonp",
		// 			cache: "false",
		// 			crossDomain: "true",
		// 			processData: "true",
		// 			beforeSend: function(){
		// 				//$.mobile.loading('show');
		// 				$(".ui-loader").css('display','block');
		// 			},
		// 			complete: function(){
		// 				//$.mobile.loading('hide');
		// 				$(".ui-loader").css('display','none');
		// 			},
		// 			success: function(data){
		// 				//for each item : data
		// 					//create <td>date
		// 					//create <th>time
		// 					//create 

		// 				fillScheduleRows(data);
		// 			},
		// 			error: function(XMLHttpRequest, textStatus, errorThrown){
		// 				console.log("ERROR!");
		// 			}
		// 		});	
		// 	});
		// 	$("#roster-link").click(function(event){
		// 		$.ajax({
		// 			type: "GET",
		// 			url: "http://www.gthockey.com/api/roster.php",
		// 			dataType: "jsonp",
		// 			cache: "false",
		// 			crossDomain: "true",
		// 			processData: "true",
		// 			beforeSend: function(){
		// 				//$.mobile.loading('show');
		// 				$(".ui-loader").css('display','block');
		// 			},
		// 			complete: function(){
		// 				//$.mobile.loading('hide');
		// 				$(".ui-loader").css('display','none');
		// 			},
		// 			success: function(data){
		// 				console.log(data);
		// 				//for each item : data
		// 					//create <td>date
		// 					//create <th>time
		// 					//create 
		// 				fillRosterRows(data);

		// 			},
		// 			error: function(XMLHttpRequest, textStatus, errorThrown){
		// 				console.log("ERROR!");
		// 				console.log(XMLHttpRequest);
		// 				console.log(textStatus);
		// 				console.log(errorThrown);
		// 			}
		// 		});	
		// 	});

		// 	$("#statistics-link").click(function(event){
		// 		console.log("Ajax Request for Statistics Data");
		// 	});

		// 	function fillScheduleRows(jsonData){
		// 		$.each(jsonData, function(i,item){

		// 			//append a tr to the tbod
		// 			if(item.home == 0){
		// 				var opponent = item.opponent;
		// 			}
		// 			else{
		// 				var opponent = "@"+item.opponent;
		// 			}
		// 			//append the row to the table
		// 			$("#schedule-table tbody:last").append("<tr><th data-priority=1>"+item.date+"</th><td data-priority=2>"+item.time+"</td><td data-priority=3>"+opponent+"</td><td data-priority=4>TBA</td></tr>");
		// 		});
		// 	}

		// 	function fillRosterRows(jsonData){
		// 		$.each(jsonData, function(i,item){
		// 			//append the row to the table
		// 			$("#roster-table tbody:last").append("<tr><th data-priority=1>"+item.number+"</th><td data-priority=2>"+item.name+"</td><td data-priority=3>"+item.position+"</td></tr>");
		// 		});
		// 	}
		// });
	</script>
	</body>
</html>